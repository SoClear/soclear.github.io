<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta charset="UTF-8">
    <title>SoClear</title>
    <link rel="icon" href="favicon.svg" />
    <!-- CSS -->
    <!-- Theme: darklight -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-darklight-theme@latest/dist/style.min.css" />
    <!-- arrow style sidebar collapse -->
    <style>
        .sidebar-nav li {
            margin: 0;
        }

        .sidebar-nav ul:not(.app-sub-sidebar)>li.folder::before {
            content: '▶ ';
        }

        .sidebar-nav ul:not(.app-sub-sidebar)>li.folder.open::before {
            content: '▼ ';
        }
    </style>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/sidebar.min.css" /> -->
    <!-- MiSans -->
    <link rel="stylesheet" href="https://font.sec.miui.com/font/css?family=MiSans:400,700:MiSans" />
    <!-- docsify-latex -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css" />

    <style>
        :root {
            --codeFontFamily: '';
            --background: black
        }

        div.medium-zoom-overlay {
            background-color: black !important;
        }

        .markdown-section pre>code {
            font-family: var(--codeFontFamily);
        }

        :has(#app) {
            background-color: black;
        }

        #app {
            color: gray;
        }

        body {
            font-variant-ligatures: none;
        }

        docsify-latex>span.katex {
            padding: 2px;
        }

        /* 行内代码块自动换行 */
        .markdown-section code {
            white-space: pre-wrap;      /* 保留格式并自动换行 */
            word-wrap: break-word;      /* 旧版浏览器兼容 */
            overflow-wrap: break-word;  /* 强制在长单词内换行 */
        }

        @font-face {
            font-family: 'Maple Mono';
            src: url('assets/fonts/MapleMonoNormalNL-Regular.ttf.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        .markdown-section pre.shiki {
            /* 移除额外的内边距，因为 Shiki 内部可能有 */
            padding: 0;
            /* 确保和 github-dark-default 一致，或者设为 transparent */
            background-color: transparent;
        }
        /* 移除 code 标签的背景，防止双重背景 */
        .markdown-section pre.shiki > code {
            background: none !important;
            font-family: var(--codeFontFamily) !important;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "shiki": "https://cdn.jsdelivr.net/npm/shiki@1/+esm"
            }
        }
    </script>
</head>

<body>
    <div id="app">加载中</div>
    <script>
        window.$docsify = {
            name: 'soclear',
            nameLink: '/.docsify/index.html#/',
            basePath: '/docs/',
            homepage: '../.docsify/home.md',
            loadSidebar: '/.docsify/_sidebar.md',
            alias: {
                '/.*/_sidebar.md': '../.docsify/_sidebar.md'
            },
            relativePath: true,
            subMaxLevel: 6,
            auto2top: true,
            pagination: {
                crossChapter: true,
                crossChapterText: true,
            },
            search: {
                placeholder: '搜索',
                noData: '找不到结果!'
            },
            copyCode: {
                buttonText: '点击复制',
                errorText: '错误',
                successText: '已复制到剪贴板'
            },
            darklightTheme: {
                defaultTheme: 'dark',
                siteFont: 'MiSans',
                codeFontFamily: 'Maple Mono, Roboto Mono, Monaco, courier, monospace',
                dark: {
                    accent: '#42b983',
                    toogleBackground: '#ffffff',
                    background: '#000000',
                    textColor: '#b4b4b4',
                    codeTextColor: '#ffffff',
                    codeBackgroundColor: '#0e0e0e',
                    borderColor: '#0d2538',
                    blockQuoteColor: 'var(--textColor)',
                    highlightColor: '#d22778',
                    sidebarSublink: '#b4b4b4',
                    codeTypeColor: '#ffffff',
                    coverBackground: 'linear-gradient(to left bottom, hsl(118, 100%, 85%) 0%,hsl(181, 100%, 85%) 100%)',
                }
            }
        }
    </script>
    <!-- docisfy -->
    <script src="https://cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>

    <!-- plugins -->
    <!-- docsify-sidebar-collapse -->
    <script type="module" async src="https://cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js"></script>
    <!-- docsify-wikilink -->
    <script type="module" async src="https://cdn.jsdelivr.net/npm/docsify-wikilink@1"></script>
    <!-- docsify-zoom-image -->
    <script type="module" async src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
    <!-- docsify-pagination -->
    <script type="module" async src="https://cdn.jsdelivr.net/npm/docsify-pagination@latest/dist/docsify-pagination.min.js"></script>
    <!-- docsify-search -->
    <script type="module" async src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
    <!-- docsify-copy-code -->
    <script type="module" async src="https://cdn.jsdelivr.net/npm/docsify-copy-code/dist/docsify-copy-code.min.js"></script>
    <!-- docsify-darklight-theme -->
    <script type="module" async src="https://cdn.jsdelivr.net/npm/docsify-darklight-theme@latest/dist/index.min.js"></script>
    <!-- docsify-latex -->
    <script type="module" async src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
    <script type="module" async src="https://cdn.jsdelivr.net/npm/docsify-latex@0"></script>
    <!-- mermaid -->
    <script type="module" async data-cfasync="false">
        import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";

        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark'
        });

        let svgCounter = 0;

        window.$docsify.markdown = {
            renderer: {
                code(code, lang) {
                    if (lang === "mermaid") {
                        const svgName = `mermaid-svg-${svgCounter++}`;
                        const MERMAID_CONTAINER_ID = `${svgName}-container`;
                        mermaid.render(svgName, code).then(({ svg }) => {
                            const containerElement = document.querySelector(
                                `#${MERMAID_CONTAINER_ID}`
                            );
                            if (containerElement) {
                                containerElement.innerHTML = svg;
                            } else {
                                console.error(`Error: #${MERMAID_CONTAINER_ID} not found`);
                            }
                        });
                        return `<div class="mermaid" id="${MERMAID_CONTAINER_ID}"></div>`;
                    }
                    return this.origin.code.apply(this, arguments);
                },
            },
        };
    </script>
    <!-- shiki -->
    <script type="module">
        import { createHighlighter } from 'shiki';

        // 引入你的主题和语言
        import githubDarkDefault from 'https://cdn.jsdelivr.net/npm/@shikijs/themes@1/dist/github-dark-default.mjs';
        import kotlin from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/kotlin.mjs';
        import java from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/java.mjs';
        import sql from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/sql.mjs';
        import c from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/c.mjs';
        import rust from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/rust.mjs';
        import js from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/js.mjs';
        import ts from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/ts.mjs';
        import vue from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/vue.mjs';
        import cpp from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/cpp.mjs';
        import xml from 'https://cdn.jsdelivr.net/npm/@shikijs/langs@1/dist/xml.mjs';

        // 定义插件
        const shikiPlugin = (hook, vm) => {
            let highlighter = null;

            // 1. 初始化 Shiki
            hook.init(function() {
                createHighlighter({
                    themes: [githubDarkDefault],
                    langs: [kotlin, java, sql, c, rust, js, ts, vue, cpp, xml]
                }).then(h => {
                    highlighter = h;
                    // 初始化完成后，尝试高亮当前页面（处理首屏加载慢的情况）
                    highlightCurrentPage();
                }).catch(err => {
                    console.error('[Shiki] Init failed:', err);
                });
            });

            // 2. 每次页面切换/渲染后调用
            hook.doneEach(function() {
                highlightCurrentPage();
            });

            // 核心高亮逻辑
            function highlightCurrentPage() {
                if (!highlighter) return;

                const content = document.querySelector('.markdown-section');
                if (!content) return;

                // 查找所有代码块 (Docsify 生成的格式是 pre[data-lang])
                const codeBlocks = content.querySelectorAll('pre[data-lang]');

                codeBlocks.forEach(pre => {
                    // 防止重复处理
                    if (pre.getAttribute('data-shiki-processed')) return;
                    
                    const lang = pre.getAttribute('data-lang');
                    // 跳过 Mermaid 图表
                    if (lang === 'mermaid') return;

                    const codeElement = pre.querySelector('code');
                    if (!codeElement) return;

                    // 获取原始内容
                    const code = codeElement.textContent;

                    // 暂存 Docsify Copy Code 插件生成的按钮 (如果有)
                    const copyBtn = pre.querySelector('.docsify-copy-code-button');

                    try {
                        // 生成高亮 HTML
                        const html = highlighter.codeToHtml(code, {
                            lang: lang,
                            theme: 'github-dark-default'
                        });

                        // 创建临时元素来解析 HTML
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = html;
                        const newPre = tempDiv.firstElementChild;

                        // 迁移必要的类名和属性，保持样式兼容
                        newPre.setAttribute('data-lang', lang);
                        newPre.setAttribute('data-shiki-processed', 'true');
                        newPre.classList.add('shiki'); // 加上 shiki 类名以便 CSS 覆盖

                        // 如果之前有复制按钮，把它加回到新结构中
                        if (copyBtn) {
                            newPre.appendChild(copyBtn);
                        }

                        // 替换 DOM
                        pre.replaceWith(newPre);

                    } catch (e) {
                        console.warn(`[Shiki] Failed to highlight ${lang}:`, e);
                        // 失败时不替换，保留原文
                    }
                });
            }
        };

        // 注册插件
        window.$docsify.plugins = [].concat(shikiPlugin, window.$docsify.plugins);
    </script>

    <!-- Offline Mode -->
    <script type="module" async>
        if (typeof navigator.serviceWorker !== 'undefined') {
            navigator.serviceWorker.register('sw.js')
        }
    </script>
</body>

</html>